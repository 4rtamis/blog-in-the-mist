---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import Layout from "@layouts/Layout.astro";
import { CHARACTERS } from "@consts";

const characters = (await getCollection("characters")).sort((a, b) =>
  a.data.name.localeCompare(b.data.name),
);
---

<Layout title={CHARACTERS.TITLE} description={CHARACTERS.DESCRIPTION}>
  <Container>
    <aside>
      <div class="space-y-12">
        <div class="animate space-y-3">
          <p class="text-xs uppercase tracking-[0.2em] text-black/60">
            City dossiers
          </p>
          <h1 class="text-4xl font-semibold text-black underline decoration-4">
            {CHARACTERS.TITLE}
          </h1>
          <p class="max-w-3xl text-lg text-black">
            {CHARACTERS.DESCRIPTION}
          </p>
        </div>

        <div class="grid gap-6 lg:grid-cols-2">
          {characters.map((character) => (
            <article
              class="animate rounded-lg border border-black/10 bg-[#f5f1e5] p-5 shadow-black/10 transition-transform duration-300 ease-in-out hover:-translate-y-1 hover:shadow-md focus-within:-translate-y-1 focus-within:shadow-md"
            >
              <div class="flex items-start justify-between gap-3">
                <div class="space-y-1">
                  <p class="text-xs uppercase tracking-wide text-black/60">
                    {character.data.mythos}
                  </p>
                  <h2 class="text-2xl font-bold text-black">
                    <a
                      href={`/characters/${character.id}`}
                      class="transition-colors duration-300 ease-in-out hover:underline focus-visible:underline"
                    >
                      {character.data.name}
                    </a>
                  </h2>
                  <p class="text-sm text-black/80">{character.data.logos}</p>
                </div>
                <div
                  class="rounded-sm bg-[#514A48] px-3 py-1 text-xs font-semibold uppercase text-[#e0d9c1]"
                >
                  {character.data.themes.length} Themes
                </div>
              </div>

              <div class="mt-4 flex flex-wrap gap-2 text-xs font-semibold uppercase">
                <span class="rounded-sm bg-black/10 px-2 py-1">
                  Build Up {character.data.build_up}/5
                </span>
                <span class="rounded-sm bg-black/5 px-2 py-1">
                  {character.data.moments_of_evolution.length} Moments
                </span>
              </div>

              <div class="mt-4 space-y-1 text-sm text-black">
                {character.data.themes.slice(0, 3).map((theme) => (
                  <div class="flex flex-wrap items-center gap-2">
                    <span
                      class="rounded-sm bg-black/10 px-2 py-0.5 text-[11px] font-semibold uppercase"
                    >
                      {theme.type}
                    </span>
                    <span class="font-semibold">{theme.title}</span>
                    <span class="text-black/50">({theme.themebook})</span>
                  </div>
                ))}
                {character.data.themes.length > 3 && (
                  <div class="text-xs uppercase tracking-wide text-black/60">
                    +{character.data.themes.length - 3} more themes
                  </div>
                )}
              </div>

              <a
                href={`/characters/${character.id}`}
                class="group mt-5 inline-flex items-center gap-2 text-sm font-semibold uppercase text-black transition-colors duration-300 ease-in-out hover:text-[#514A48] focus-visible:text-[#514A48]"
              >
                Read dossier
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  class="size-4 fill-none stroke-current stroke-2"
                >
                  <line
                    x1="5"
                    y1="12"
                    x2="19"
                    y2="12"
                    class="translate-x-1 scale-x-75 transition-transform duration-300 ease-in-out group-hover:translate-x-0 group-hover:scale-x-100 group-focus-visible:translate-x-0 group-focus-visible:scale-x-100"
                  ></line>
                  <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
              </a>
            </article>
          ))}
        </div>
      </div>
    </aside>
  </Container>
</Layout>
